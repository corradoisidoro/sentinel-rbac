# Sentinel RBAC ğŸ”

[![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)](https://golang.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue?style=flat)](LICENSE)
[![Build](https://img.shields.io/badge/build-passing-brightgreen?style=flat)]()
[![Tests](https://img.shields.io/badge/tests-passing-brightgreen?style=flat)]()
[![Swagger](https://img.shields.io/badge/docs-swagger-85EA2D?style=flat&logo=swagger)](http://localhost:8080/swagger/index.html)

A Go REST API demonstrating best-practice architecture for authentication, authorization, and secure service design â€” built with clarity and simplicity in mind, not complexity for its own sake.

---

## What This Demonstrates

- How to structure a clean, layered Go service (Handler â†’ Service â†’ Repository)
- JWT authentication with secure cookie handling
- Role-based access control with reusable middleware
- Multi-layer rate limiting without third-party dependencies
- Graceful shutdown and config-driven setup
- Auto-generated, interactive API documentation via Swagger

---

## Architecture

```
sentinel-rbac/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ main.go           # Entrypoint, wiring, server lifecycle
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/               # Environment config loading & validation
â”‚   â”œâ”€â”€ handler/              # HTTP handlers (Gin) + Swagger annotations
â”‚   â”œâ”€â”€ middleware/            # Auth, RBAC, Rate Limiting
â”‚   â”œâ”€â”€ models/               # GORM models
â”‚   â”œâ”€â”€ repository/           # Data access layer
â”‚   â””â”€â”€ service/              # Business logic
â””â”€â”€ docs/                     # Auto-generated Swagger spec (do not edit)
```

---

## Quick Start

**Prerequisites:** Go 1.21+, Git

```bash
git clone https://github.com/corradoisidoro/sentinel-rbac.git
cd sentinel-rbac
```

Create a `.env` file or export the following:

```env
DATABASE_URL=sentinel.db
JWT_SECRET=your-secret-key-here
SERVER_PORT=8080
```

Run the server:

```bash
go run ./cmd/api
```

The API will be available at `http://localhost:8080`.

---

## API Documentation (Swagger)

Sentinel RBAC ships with interactive API documentation generated by [swaggo/swag](https://github.com/swaggo/swag).

**Access the Swagger UI:**
```
http://localhost:8080/swagger/index.html
```

The UI lets you explore all endpoints, inspect request/response schemas, and execute live requests directly from the browser â€” no Postman needed.

**Regenerating the docs** (required after modifying handler annotations):

```bash
# Install swag CLI if you haven't already
go install github.com/swaggo/swag/cmd/swag@latest

# Regenerate
swag init --dir ./cmd/api,./internal/handler --output ./docs
```

> The `docs/` directory is auto-generated. Do not edit those files manually.

---

## API Endpoints

| Method | Path | Auth | Role | Description |
|--------|------|------|------|-------------|
| GET | `/ping` | â€” | â€” | Health check |
| POST | `/api/auth/register` | â€” | â€” | Create account |
| POST | `/api/auth/login` | â€” | â€” | Login, receive JWT |
| POST | `/api/auth/logout` | âœ… | any | Clear auth cookie |
| GET | `/api/users/profile` | âœ… | any | Get own profile |
| GET | `/api/users/admin` | âœ… | admin | Admin dashboard |

---

## User Flow

```
POST /register â”€â”€â–º POST /login â”€â”€â–º JWT issued
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                      â–¼
             GET /profile                          GET /admin
             (any role)                            (admin only)
             HTTP 200 âœ…                           HTTP 403 âŒ if not admin
                    â”‚
                    â–¼
             POST /logout
             Cookie cleared
```

**Unauthenticated access to protected routes returns HTTP 401.**

---

## Rate Limiting

Three independent layers using `golang.org/x/time/rate` â€” no external service required:

| Layer | Limit | Purpose |
|-------|-------|---------|
| Global | 500 RPS / burst 1000 | Protects overall server capacity |
| Per-IP | 20 RPS / burst 40 | Prevents abuse from a single client |
| Per-Route | 100 RPS / burst 200 | Shields expensive endpoints |

---

## Running Tests

```bash
go test ./...           # All tests
go test ./... -v        # Verbose output
go test -race ./...     # Race condition detection
```

---

## Tech Stack

| Layer | Technology |
|-------|-----------|
| Language | Go 1.21+ |
| HTTP Framework | Gin |
| ORM | GORM |
| Database | SQLite |
| Auth | JWT (`golang-jwt/jwt`) |
| Rate Limiting | `golang.org/x/time/rate` |
| API Docs | Swaggo / Swagger UI |

---

## License

MIT â€” see [LICENSE](LICENSE) for details.
